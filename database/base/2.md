# 数据库1NF、2NF、3NF、BCNF

目前已经有6NF。  
但设计数据库时最多考虑到BCNF就够了。（三大范式加上BCNF就是四大范式。）

范式的定义：**符合某一级别的关系模式的集合，表示一个关系内部各属性之间的联系的合理化程度**。可以粗略地理解为一张数据表的表结构符合某种设计标准的级别。  
符合高一级范式的设计，必定符合低一级的范式。

### 1NF

第一范式，关系中每个属性都不可再分。换句话说就是数据表的列不可再分。

学号|姓名|选课
:--|:--|:--
10001|张三|数学，语文，英语
10002|李四|语文，英语
10003|王五|语文，英语，历史

上表的选课列明显可以再分，违反1NF。

### 2NF

2NF在1NF的基础之上，消除了非主属性对于码的部分函数依赖。（函数依赖这部分内容可以阅读引用2。当然，要是想搞懂还是看看金培权老师的PPT和读《数据库系统实现》，感觉这个回答有几个地方说的有问题，评论里也没有给出解释。）

2NF就是要求属性都完全依赖于主键。

学号|课程|成绩|课程学分
:--|:--|:--|:--
10001|数学|100|6
10001|语文|90|2
10002|语文|85|2
10002|数学|90|6

F={(学号, 课程) -> (成绩, 课程学分)}。  
因为表中存在(课程) -> (课程学分)，不满足2NF。  
为了上上表满足2NF的要求，必须消除这些部分函数依赖：将大数据表拆分为两个或多个更小的数据表。也叫“**模式分解**”。模式分解不是唯一的办法。

拆分为两个表：  
* 学生成绩表(学号, 课程, 成绩)，F={(学号, 课程) -> (成绩)}
* 课程学分表(课程, 课程学分)，F={(课程) -> (课程学分)}

### 3NF

3NF在2NF的基础之上，消除了非主属性对于码的传递函数依赖。  
3NF应用的举例可以参考引用2，说的不错。

举例：

学号|姓名|性别|班级|班主任
:--|:--|:--|:--|:--
10001|张三|男|一班|小王
10002|李四|男|一班| 小王
10003|王五|男|二班|小李
10004|张小三|男|二班|小李

(学号) -> (姓名, 性别, 班级, 班主任)，满足2NF。  
但表中存在一个传递性依赖，学号 -> 班级 -> 班主任，不满足3NF。

拆分为两个表：
* 学生信息表(学号, 姓名, 性别, 班级)，F={(学号) -> (姓名, 性别, 班级)}
* 班级信息表(班级, 班主任)，F={(班级) -> (班主任)}

### BCNF

2NF和3NF的应以都假设了R只有一个候选码，但一般情况下R可能有多个候选码，且不同的候选码之间还可能相互重复。  
BCNF扩充了3NF，可以处理R有多个候选码的情形，进一步消除了主属性对码的部分和传递函数依赖。

3NF：不允许非主属性到非码的FD，但允许主属性到其他属性的FD。  
BCNF：不允许主属性、非主属性到非码的FD。

举例：某公司有若干仓库；每个仓库有且仅有一名管理员，一个管理员只能在一个仓库干活；一个仓库可以存放多种物品，一个物品也可以存放在不同仓库，每个物品在每个仓库都有对应的数量。满足3NF：

仓库名|管理员|物品名|数量
:--|:--|:--|:--
上海仓|张三|手机|20
北京仓|李四|电脑|30
上海仓|张三|手机|50
北京仓|李四|洗衣机|60

上表已知：
* 仓库名 -> 管理员
* 管理员 -> 仓库名
* (仓库名, 物品名) -> 数量

码：管理员、仓库名、(仓库名, 物品名)  
主属性：仓库名、管理员、物品名  
非主属性：数量

存在的问题：  
1. 插入异常：新增加一个仓库，但未存放物品，不能为新仓库指派管理员。
2. 删除异常：某仓库被清空后，删除所有于这个仓库相关的物品库存信息，带来的副作用是仓库本身和管理员信息随之删除。
3. 更新异常：某仓库换管理员，导致该仓库有多少条物品库存信息，就要修改多少条记录。
4. 数据冗余：仓库的管理员名字重复存储

模式分解：  
* 仓库(仓库名, 管理员)，F={仓库名 -> 管理员}
* 库存(仓库名, 物品名, 数量)，F={(仓库名, 物品名) -> 数量}

Ref.:  
[什么是第一，第二，第三范式](http://blog.csdn.net/xidianliuy/article/details/51566576)  
[解释一下关系数据库的第一第二第三范式？ - 刘慰的回答 - 知乎](https://www.zhihu.com/question/24696366/answer/29189700)  
金培权 - 高级数据库技术《第三章 数据库设计》
